{% extends 'base_generic.html' %}

{% block title %}Lista de Calificaciones{% endblock %}

{% block extrahead %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<style>
    .table thead th {
        color: white;
        background-color: #343a40;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- Botones de acción (DENTRO del bloque content) -->
    <div class="mb-3">
        <a href="{% url 'crear_asignatura' %}" class="btn btn-success">Nueva Asignatura</a>
        <a href="{% url 'crear_calificacion' %}" class="btn btn-info">Nueva Calificación</a>
    </div>

    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">{{ message }}</div>
        {% endfor %}
    {% endif %}

    <!-- Filtros -->
    <form method="get" class="mb-4">
        <div class="row">
            <div class="col-md-5">
                <label for="asignatura" class="form-label">Asignatura</label>
                <select name="asignatura" id="asignatura" class="form-select">
                    <option value="">Todas</option>
                    {% for asignatura in asignaturas %}
                        <option value="{{ asignatura.id }}" {% if request.GET.asignatura == asignatura.id|stringformat:"s" %}selected{% endif %}>
                            {{ asignatura.nombre }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-5">
                <label for="periodo" class="form-label">Período</label>
                <select name="periodo" id="periodo" class="form-select">
                    <option value="">Todos</option>
                    {% for periodo in periodos %}
                        <option value="{{ periodo.id }}" {% if request.GET.periodo == periodo.id|stringformat:"s" %}selected{% endif %}>
                            {{ periodo.nombre }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2 d-flex align-items-end">
                <button type="submit" class="btn btn-primary w-100">Filtrar</button>
            </div>
        </div>
    </form>

    <!-- Tabla de calificaciones -->
    {% if calificaciones %}
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Estudiante</th>
                    <th>Asignatura</th>
                    <th>Período</th>
                    <th>Calificación</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for calificacion in calificaciones %}
                <tr>
                    <td>{{ calificacion.estudiante.user.get_full_name }}</td>
                    <td>{{ calificacion.asignatura.nombre }}</td>
                    <td>{{ calificacion.periodo }}</td>
                    <td>
                        <span id="nota-{{ calificacion.id }}">{{ calificacion.nota }}</span>
                        <input type="number" 
                               id="edit-nota-{{ calificacion.id }}" 
                               class="form-control d-none" 
                               value="{{ calificacion.nota }}" 
                               min="0" 
                               max="5" 
                               step="0.1">
                    </td>
                    <td>
                        <button class="btn btn-sm btn-primary edit-btn" data-id="{{ calificacion.id }}">
                            <i class="fas fa-pencil-alt"></i>
                        </button>
                        <button class="btn btn-sm btn-success save-btn d-none" data-id="{{ calificacion.id }}">
                            <i class="fas fa-save"></i>
                        </button>
                        <button class="btn btn-sm btn-danger cancel-btn d-none" data-id="{{ calificacion.id }}">
                            <i class="fas fa-times"></i>
                        </button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <div class="alert alert-info">No hay calificaciones registradas.</div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Código JavaScript existente...
});
</script>
{% endblock %}