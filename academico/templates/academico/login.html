<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classmate - Portal Académico</title>

    <!-- Optimización de carga de recursos críticos -->
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" as="style">
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" as="style">
    <link rel="preload" href="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js" as="script">

    <!-- Carga diferida de recursos no críticos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" media="print" onload="this.media='all'">

    {% load static %}
    <link rel="stylesheet" href="{% static 'css/login.css' %}">

    <!-- Optimización de iconos Font Awesome -->
    <style>
        .fas {
            font-display: swap;
            will-change: transform;
            transform: translateZ(0);
        }

        /* Optimización de rendimiento */
        .login-card {
            contain: layout style paint;
            transform: translateZ(0);
            will-change: transform;
        }

        /* Prevención de CLS */
        .form-group {
            min-height: 60px;
            contain: layout style;
        }

        /* Optimización de animaciones */
        @media (prefers-reduced-motion: reduce) {
            .animate__animated {
                animation: none !important;
                transition: none !important;
            }

            .holographic-effect,
            .particles-container {
                display: none !important;
            }
        }

        /* Optimización de renderizado */
        .input-icon,
        .btn-arrow {
            will-change: transform;
            transform: translateZ(0);
        }
    </style>
</head>
<body>
    <!-- Fondo de partículas futurista -->
    <div class="particles-container" id="particles-js"></div>

    <!-- Efecto de grid holográfico -->
    <div class="grid-effect"></div>

    <!-- Contenedor principal con animación -->
    <div class="login-container animate__animated animate__fadeIn">
        <div class="login-card">
            <!-- Efecto holográfico superior -->
            <div class="holographic-effect"></div>

            <!-- Efecto de esquinas futuristas -->
            <div class="corner corner-tl"></div>
            <div class="corner corner-tr"></div>
            <div class="corner corner-bl"></div>
            <div class="corner corner-br"></div>

            <!-- Encabezado con animación -->
            <div class="login-header animate__animated animate__fadeInDown">
                <div class="logo">
                    <div class="logo-icon animate__animated animate__pulse animate__infinite animate__slower">
                        <i class="fas fa-graduation-cap"></i>
                    </div>
                    <h1 class="animate__animated animate__fadeInRight">CLASS<span>MATE</span></h1>
                </div>
                <p class="subtitle animate__animated animate__fadeIn animate__delay-1s">Tu portal académico del futuro</p>
            </div>

            <!-- Cuerpo del formulario -->
            <div class="login-body animate__animated animate__fadeIn animate__delay-1s">
                {% if messages %}
                    {% for message in messages %}
                    <div class="alert-message animate__animated animate__headShake animate__delay-2s">
                        <i class="fas fa-exclamation-circle"></i> {{ message }}
                    </div>
                    {% endfor %}
                {% endif %}

                <form method="post" class="login-form animate__animated animate__fadeIn animate__delay-2s">
                    {% csrf_token %}

                    <!-- Campo Usuario -->
                    <div class="form-group">
                        <i class="fas fa-user input-icon"></i>
                        <input type="text" name="username" id="id_username" required autofocus>
                        <label for="id_username">Usuario o Email</label>
                        <div class="underline"></div>
                    </div>

                    <!-- Campo Contraseña -->
                    <div class="form-group">
                        <i class="fas fa-lock input-icon"></i>
                        <input type="password" name="password" id="id_password" required>
                        <label for="id_password">Contraseña</label>
                        <div class="underline"></div>
                        <button type="button" class="show-password" aria-label="Mostrar contraseña">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>

                    <!-- Botón de Submit -->
                    <button type="submit" class="login-btn">
                        <span>Acceder al Portal</span>
                        <div class="btn-effect"></div>
                        <i class="fas fa-arrow-right btn-arrow"></i>
                    </button>
                </form>

                <!-- Enlaces adicionales -->
                <div class="login-links animate__animated animate__fadeIn animate__delay-3s">
                    <a href="{% url 'recuperar_contrasena_usuario' %}" class="forgot-password">
                        <i class="fas fa-key"></i> ¿Olvidaste tu contraseña?
                    </a>
                </div>
            </div>

            <!-- Pie de página -->
            <div class="login-footer animate__animated animate__fadeIn animate__delay-3s">
                <div class="tech-icons">
                    <i class="fas fa-shield-alt"></i>
                    <i class="fas fa-bolt"></i>
                    <i class="fas fa-cloud"></i>
                </div>
                <p>&copy; {{ year|default:"2025" }} Classmate v4.0 - Plataforma Académica Inteligente</p>
            </div>
        </div>
    </div>

    <!-- Script para partículas -->
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <script>
        // Inicialización de partículas mejorada
        document.addEventListener('DOMContentLoaded', function() {
            // Configuración de partículas futurista
            if (document.getElementById('particles-js')) {
                particlesJS('particles-js', {
                    particles: {
                        number: {
                            value: 120,
                            density: {
                                enable: true,
                                value_area: 1000
                            }
                        },
                        color: {
                            value: ["#e63946", "#ffffff", "#aaaaaa"]
                        },
                        shape: {
                            type: ["circle", "triangle", "edge"],
                            stroke: {
                                width: 0,
                                color: "#000000"
                            },
                            polygon: {
                                nb_sides: 5
                            }
                        },
                        opacity: {
                            value: 0.7,
                            random: true,
                            anim: {
                                enable: true,
                                speed: 1,
                                opacity_min: 0.1,
                                sync: false
                            }
                        },
                        size: {
                            value: 3,
                            random: true,
                            anim: {
                                enable: true,
                                speed: 2,
                                size_min: 0.1,
                                sync: false
                            }
                        },
                        line_linked: {
                            enable: true,
                            distance: 150,
                            color: "#e63946",
                            opacity: 0.4,
                            width: 1.2,
                            shadow: {
                                enable: true,
                                blur: 5,
                                color: "#e63946"
                            }
                        },
                        move: {
                            enable: true,
                            speed: 3,
                            direction: "none",
                            random: true,
                            straight: false,
                            out_mode: "bounce",
                            bounce: true,
                            attract: {
                                enable: true,
                                rotateX: 600,
                                rotateY: 1200
                            }
                        }
                    },
                    interactivity: {
                        detect_on: "canvas",
                        events: {
                            onhover: {
                                enable: true,
                                mode: "bubble"
                            },
                            onclick: {
                                enable: true,
                                mode: "push"
                            },
                            resize: true
                        },
                        modes: {
                            bubble: {
                                distance: 200,
                                size: 6,
                                duration: 2,
                                opacity: 0.8,
                                speed: 3
                            },
                            push: {
                                particles_nb: 4
                            }
                        }
                    },
                    retina_detect: true
                });
            }

            // Efecto 3D mejorado para la tarjeta
            const card = document.querySelector('.login-card');
            if (card) {
                card.addEventListener('mousemove', (e) => {
                    const xAxis = (window.innerWidth / 2 - e.pageX) / 15;
                    const yAxis = (window.innerHeight / 2 - e.pageY) / 15;
                    card.style.transform = `rotateY(${xAxis}deg) rotateX(${yAxis}deg) scale(1.02)`;
                    card.style.boxShadow = `${xAxis * 2}px ${yAxis * 2}px 30px rgba(0, 0, 0, 0.3)`;

                    // Efecto parallax en elementos internos
                    const logo = document.querySelector('.logo-icon');
                    const title = document.querySelector('.logo h1');
                    const form = document.querySelector('.login-form');

                    if(logo) logo.style.transform = `translateZ(50px)`;
                    if(title) title.style.transform = `translateZ(30px)`;
                    if(form) form.style.transform = `translateZ(20px)`;
                });

                card.addEventListener('mouseenter', () => {
                    card.style.transition = 'all 0.1s ease';
                });

                card.addEventListener('mouseleave', () => {
                    card.style.transition = 'all 0.5s ease';
                    card.style.transform = 'rotateY(0deg) rotateX(0deg) scale(1)';
                    card.style.boxShadow = '0 25px 45px rgba(0, 0, 0, 0.2)';

                    // Resetear elementos internos
                    const logo = document.querySelector('.logo-icon');
                    const title = document.querySelector('.logo h1');
                    const form = document.querySelector('.login-form');

                    if(logo) logo.style.transform = `translateZ(0px)`;
                    if(title) title.style.transform = `translateZ(0px)`;
                    if(form) form.style.transform = `translateZ(0px)`;
                });
            }

            // Mostrar/ocultar contraseña
            const showPasswordBtn = document.querySelector('.show-password');
            const passwordInput = document.getElementById('id_password');

            if(showPasswordBtn && passwordInput) {
                showPasswordBtn.addEventListener('click', () => {
                    requestAnimationFrame(() => {
                        const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                        passwordInput.setAttribute('type', type);
                        showPasswordBtn.innerHTML = type === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
                    });
                });
            }

            // Efecto de carga al enviar el formulario
            const loginForm = document.querySelector('.login-form');
            if(loginForm) {
                loginForm.addEventListener('submit', function(e) {
                    const submitBtn = this.querySelector('.login-btn');
                    if(submitBtn) {
                        submitBtn.innerHTML = '<span>Autenticando...</span><div class="btn-loader"></div>';
                        submitBtn.disabled = true;
                    }
                });
            }
        });
    </script>
</body>
</html>
